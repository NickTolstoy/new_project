# Настройка базы данных для хранения отзывов

Система хранения отзывов теперь поддерживает работу с MySQL базой данных. Это позволяет хранить отзывы на сервере, что дает следующие преимущества:
- Централизованное хранение всех отзывов
- Более надежное сохранение данных
- Возможность модерации отзывов
- Возможность создания расширенной аналитики

## Требования

- Node.js 14+ 
- MySQL 5.7+ или MariaDB 10.3+
- Права доступа для создания базы данных и таблиц

## Установка и настройка

### 1. Установите MySQL

Если у вас еще нет установленного MySQL, установите его:

- **MacOS:**
  ```
  brew install mysql
  brew services start mysql
  ```

- **Ubuntu/Debian:**
  ```
  sudo apt update
  sudo apt install mysql-server
  sudo systemctl start mysql.service
  ```

- **Windows:**
  Загрузите и установите MySQL с официального сайта: https://dev.mysql.com/downloads/installer/

### 2. Создайте базу данных и таблицы

1. Установите зависимости проекта:
   ```
   npm install mysql2
   ```

2. Запустите скрипт настройки базы данных:
   ```
   npm run setup-db
   ```

   Этот скрипт автоматически создаст базу данных `autoservice_db` и все необходимые таблицы.

3. Если вам необходимо настроить параметры подключения к MySQL, используйте переменные окружения:
   ```
   DB_HOST=localhost DB_USER=root DB_PASSWORD=password npm run setup-db
   ```

### 3. Запустите сервер

После настройки базы данных запустите сервер:

```
npm run server
```

Это запустит API-сервер на порту 5000, который будет обрабатывать запросы от клиентской части.

## Проверка подключения

Вы можете проверить, успешно ли настроена база данных и сервер:

1. Откройте в браузере: http://localhost:5000/api/db-status
2. Вы должны увидеть JSON-ответ с информацией о статусе подключения к базе данных

## Миграция отзывов из localStorage

Если у вас уже были отзывы, сохраненные в localStorage, вы можете мигрировать их в базу данных:

1. Откройте сайт в браузере
2. Отзывы будут автоматически отправлены в базу данных при наличии подключения к серверу

## Устранение неполадок

### Ошибка "ER_ACCESS_DENIED_ERROR"

Эта ошибка означает неверные учетные данные MySQL. Проверьте имя пользователя и пароль:

```
DB_USER=your_username DB_PASSWORD=your_password npm run setup-db
```

### Ошибка "ECONNREFUSED"

MySQL сервер не запущен. Запустите службу MySQL:

- **MacOS:** `brew services start mysql`
- **Linux:** `sudo systemctl start mysql`
- **Windows:** Через Панель управления > Службы

### Ошибка "ER_DBACCESS_DENIED_ERROR"

У пользователя нет прав на создание базы данных. Войдите в MySQL и предоставьте права:

```sql
GRANT ALL PRIVILEGES ON *.* TO 'your_username'@'localhost';
FLUSH PRIVILEGES;
```

## Дополнительная информация

Схема базы данных находится в файле `database/schema.sql`. Вы можете изучить его для понимания структуры таблиц и связей между ними. 